window.onload = function() {
	console.log('app loading..');
	loadLandingView();
}

function loadLandingView() {
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function() {
		// here is where we manipulate our response.. whenever we get it
		if (xhr.readyState == 4) {
			console.log('response received');
			if (xhr.status == 200) {
				// success
				// we know that our response will be HTML
				$('#view').html(xhr.responseText);

				// ADD EVENT LISTENERS TO OUR HTML
				$('#submit').on('click', loginUser);
			}

		}
	}
	xhr.open("GET", "login.view");
	xhr.send();
}


function loginUser() {
	
	let username = $('#username').val();
	let password = $('#password').val();
	
	if(validateStrings(username) || validateStrings(password)){
	let xhr = new XMLHttpRequest();
	let toSend = [username, password];
	xhr.onreadystatechange = function(){
		if(xhr.readyState==4 && xhr.status==200){	
//			let name = JSON.parse(xhr.responseText);
			let name = xhr.responseText;
			console.log(xhr.getAllResponseHeaders());		
			if(name == "invalid"){
				// not logged in -- tell user about invalid credentials
				$('#message').html('<font color="red">Sorry! Invalid credentials!</font>');
			}
			else{	
				console.log("Welcome " + name);
				loadEmployeeView();
			}
		}
		
	}
	xhr.open("POST", "login");
	xhr.setRequestHeader("Content-type", "application/json");
	xhr.send(JSON.stringify(toSend));
	}
	else {
		// user entered null data or otherwise invalid strings.
		$('#message').html('Please enter valid username and password!');
	}
}

function loadEmployeeView(){
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function(){
		if(xhr.readyState == 4 && xhr.responseText){
			$('#view').html(xhr.responseText);
			$('#goToLogin').on('click', loadLoginView);
			
			//make sure that username is unique before allowing user to submit 
			$('#username').on('blur', validateUser);
			
			//create new user 
			$('#addUser').on('click', addUser);
		}
	}
	xhr.open("GET", "employee.view");
	xhr.send();
}

function validateStrings(str) {
	if(str == null || str == '') 
		return false;
	else 
		return true;
}